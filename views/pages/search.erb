<div class="container-fluid">
  <div class="row-fluid">
    <div class="span3">
      <%= erb :search_filter, :layout => false %>
    </div>
    <div class="span9">
      <ul class="nav nav-pills pull-right">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">Sort By<b class="caret"></b></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel" id="sort_by">
            <% ["Relevancy","Price","Rating","Distance"].each do |type| %>
            <li><a href="#" id="<%= type %>" value="sort"><%= type %></a></li>
            <% end %>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">Results Per Page<b class="caret"></b></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel" id="per_page">
            <% [10,20,30,40,50].each do |pages| %>
            <li><a href="#" id="<%= pages %>" value="per_page"><%= pages %></a></li>
            <% end %>
          </ul>
        </li>
      </ul>

      <table class="table table-hover">
        <thead>
        <tr>
          <th>Item</th>
          <th>Min Price</th>
          <th>Max Price</th>
          <th>Rating</th>
        </tr>
        </thead>
        <tbody>
        <% @search_results["results"].each do |result| %>
            <% matched_items = @search_results["matched_items"].assoc(result["id"].to_i).join("/") %>
            <tr onclick="$.post('/set_item/<%= matched_items %>', function(){ window.location='/item/<%= matched_items %>' });">
              <td><%= result["name"] %></td>
              <td>$<%= @search_results["price_ranges"][result["name"]]["min"] %></td>
              <td>$<%= @search_results["price_ranges"][result["name"]]["max"] %></td>
              <% rating = result["rating"] %>
              <td>
                <%= erb :rating, :locals => {:rating => rating}, :layout => false %>
              </td>
            </tr>
        <% end %>
        </tbody>
      </table>
      <div class="pagination pagination-centered">
        <ul>
          <% (1..@search_results["pages"].to_i).each do |page| %>
              <% if @search_results["page"].to_i == page %>
                  <li class="active">
                    <span><%= page %></span>
                  </li>
              <% else %>
                  <li>
                    <a href="" id="<%= page %>" value="page"><%= page %></a>
                  </li>
              <% end %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>

<script src="/js/search.js"></script>